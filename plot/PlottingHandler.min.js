OpenLayers.Handler.Plotting=OpenLayers.Class(OpenLayers.Handler,{controlPoints:[],plotting:null,isDrawing:!1,layerOptions:null,pixelTolerance:5,point:null,layer:null,multi:!1,mouseDown:!1,stoppedDown:null,lastDown:null,lastUp:null,persist:!1,stopDown:!1,stopUp:!1,touch:!1,lastTouchPx:null,initialize:function(a,b,c){c&&c.layerOptions&&c.layerOptions.styleMap||this.style||(this.style=OpenLayers.Util.extend(OpenLayers.Feature.Vector.style["default"],{}));OpenLayers.Handler.prototype.initialize.apply(this,arguments)},activate:function(){if(!OpenLayers.Handler.prototype.activate.apply(this,arguments))return!1;this.controlPoints=[];this.plotting=null;this.isDrawing=!1;var a=OpenLayers.Util.extend({displayInLayerSwitcher:!1,calculateInRange:OpenLayers.Function.True},this.layerOptions);this.layer=new OpenLayers.Layer.Vector(this.CLASS_NAME,a);this.map.addLayer(this.layer);OpenLayers.Element.addClass(this.map.viewPortDiv,"smDefault");return!0},deactivate:function(){if(!OpenLayers.Handler.prototype.deactivate.apply(this,arguments))return!1;this.controlPoints=[];this.plotting=null;this.isDrawing=!1;this.cancel();null!=this.layer.map&&(OpenLayers.Element.removeClass(this.map.viewPortDiv,"smDefault"),this.destroyFeature(!0),this.layer.destroy(!1));this.layer=null;this.touch=!1;return!0},createFeature:function(a){},modifyFeature:function(a){if(this.lastUp&&this.lastUp.equals(a))return!0;this.point&&this.plotting||this.createFeature(a);a=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=a.lon;this.point.geometry.y=a.lat;1==this.isDrawing&&(a=new OpenLayers.Geometry.Point(a.lon,a.lat),a=this.controlPoints.concat([a]),this.plotting.geometry._controlPoints=this.cloneControlPoints(a),this.plotting.geometry.calculateParts());this.callback("modify",[this.point.geometry,this.getSketch(),!1]);this.point.geometry.clearBounds();this.drawFeature()},up:function(a){},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},move:function(a){this.touch||this.mouseDown&&!this.stoppedDown||this.modifyFeature(a.xy);return!0},click:function(a){OpenLayers.Event.stop(a);return!1},dblclick:function(a){OpenLayers.Event.stop(a);return!1},destroyPersistedFeature:function(){var a=this.layer;a&&1<a.features.length&&this.layer.features[0].destroy()},addControlPoint:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.controlPoints.push(a)},drawFeature:function(){this.layer.renderer.clear();this.layer.drawFeature(this.plotting,this.style);this.layer.drawFeature(this.point,this.style)},getSketch:function(){return this.plotting},destroyFeature:function(a){!this.layer||!a&&this.persist||this.layer.destroyFeatures();this.plotting=this.point=null},finalize:function(a){this.mouseDown=!1;this.lastTouchPx=this.lastUp=this.lastDown=null;this.callback(a?"cancel":"done",[this.geometryClone()]);this.destroyFeature(a)},cancel:function(){this.finalize(!0)},getGeometry:function(){if(this.plotting&&this.plotting.geometry)return this.plotting.geometry},geometryClone:function(){var a=this.getGeometry();if(a&&a._controlPoints)return a=a.clone(),a.calculateParts(),a},mousedown:function(a){return this.down(a)},touchstart:function(a){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},mousemove:function(a){return this.move(a)},touchmove:function(a){this.lastTouchPx=a.xy;return this.move(a)},mouseup:function(a){return this.up(a)},touchend:function(a){a.xy=this.lastTouchPx;return this.up(a)},mouseout:function(a){OpenLayers.Util.mouseLeft(a,this.map.eventsDiv)&&(this.stoppedDown=this.stopDown,this.mouseDown=!1)},passesTolerance:function(a,b,c){var d=!0;null!=c&&a&&b&&a.distanceTo(b)>c&&(d=!1);return d},cloneControlPoints:function(a){for(var b=[],c=0;c<a.length;c++)b.push(a[c].clone());return b},drawComplete:function(){this.finalize();this.isDrawing=!1;this.controlPoints=[];1==this.active&&this.layer.removeAllFeatures()},CLASS_NAME:"OpenLayers.Handler.Plotting"});OpenLayers.Handler.BezierCurveArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoBezierCurveArrow);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),0<this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.BezierCurveArrow"});OpenLayers.Handler.CardinalCurveArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCardinalCurveArrow);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),0<this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.CardinalCurveArrow"});OpenLayers.Handler.CurveFlag=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCurveFlag);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a?this.isDrawing=!0:2==a?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null));return!0},touchstart:function(a){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.map.isIESingleTouch=!1;this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.addControlPoint(a.xy);1<=this.controlPoints.length&&(this.isDrawing=!0);return!0},touchend:function(a){this.drawComplete();this.map.isIESingleTouch=!0;return!1},touchmove:function(a){this.lastTouchPx=a.xy;this.modifyFeature(a.xy);return!0},CLASS_NAME:"OpenLayers.Handler.CurveFlag"});OpenLayers.Handler.DiagonalArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoDiagonalArrow);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.touch&&(this.modifyFeature(a.xy),OpenLayers.Event.stop(a));this.stoppedDown=this.stopDown;return!this.stopDown},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),1==this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.DiagonalArrow"});OpenLayers.Handler.DoubleArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoDoubleArrow);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},modifyFeature:function(a){if(this.lastUp&&this.lastUp.equals(a))return!0;this.point&&this.plotting||this.createFeature(a);var b=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;if(1==this.isDrawing){a=new OpenLayers.Geometry.Point(b.lon,b.lat);var c=this.controlPoints.length;if(2==c)var d=new OpenLayers.Geometry.Point(b.lon-(this.controlPoints[1].x-this.controlPoints[0].x),b.lat-(this.controlPoints[1].y-this.controlPoints[0].y)),d=this.controlPoints.concat([a,d]);else 3==c&&(d=this.controlPoints.concat([a]));this.plotting.geometry._controlPoints=this.cloneControlPoints(d);this.plotting.geometry.calculateParts()}this.callback("modify",[this.point.geometry,this.getSketch(),!1]);this.point.geometry.clearBounds();this.drawFeature()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1!=a&&(2==a||3==a?this.isDrawing=!0:4==a?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null)));return!0},CLASS_NAME:"OpenLayers.Handler.DoubleArrow"});OpenLayers.Handler.DoveTailDiagonalArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoDoveTailDiagonalArrow);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.touch&&(this.modifyFeature(a.xy),OpenLayers.Event.stop(a));this.stoppedDown=this.stopDown;return!this.stopDown},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),1==this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.DoveTailDiagonalArrow"});OpenLayers.Handler.DoveTailStraightArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoDoveTailStraightArrow);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.touch&&(this.modifyFeature(a.xy),OpenLayers.Event.stop(a));this.stoppedDown=this.stopDown;return!this.stopDown},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),1==this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.DoveTailStraightArrow"});OpenLayers.Handler.ParallelSearch=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoParallelSearch);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),0<this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.ParallelSearch"});OpenLayers.Handler.PolylineArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoPolylineArrow);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),0<this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.PolylineArrow"});OpenLayers.Handler.RectFlag=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoRectFlag);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a?this.isDrawing=!0:2==a?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null));return!0},touchstart:function(a){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.map.isIESingleTouch=!1;this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.addControlPoint(a.xy);1<=this.controlPoints.length&&(this.isDrawing=!0);return!0},touchend:function(a){this.drawComplete();this.map.isIESingleTouch=!0;return!1},touchmove:function(a){this.lastTouchPx=a.xy;this.modifyFeature(a.xy);return!0},CLASS_NAME:"OpenLayers.Handler.RectFlag"});OpenLayers.Handler.SectorSearch=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoSectorSearch);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a?this.isDrawing=!0:2==a&&this.drawComplete());return!0},CLASS_NAME:"OpenLayers.Handler.SectorSearch"});OpenLayers.Handler.StraightArrow=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoStraightArrow);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.touch&&(this.modifyFeature(a.xy),OpenLayers.Event.stop(a));this.stoppedDown=this.stopDown;return!this.stopDown},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),1==this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},CLASS_NAME:"OpenLayers.Handler.StraightArrow"});OpenLayers.Handler.TriangleFlag=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoTriangleFlag);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a?this.isDrawing=!0:2==a?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null));return!0},touchstart:function(a){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.map.isIESingleTouch=!1;this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.addControlPoint(a.xy);1<=this.controlPoints.length&&(this.isDrawing=!0);return!0},touchend:function(a){this.drawComplete();this.map.isIESingleTouch=!0;return!1},touchmove:function(a){this.lastTouchPx=a.xy;this.modifyFeature(a.xy);return!0},CLASS_NAME:"OpenLayers.Handler.TriangleFlag"});OpenLayers.Handler.ArcEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoArc);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a||2==a?this.isDrawing=!0:3==a&&(this.isDrawing=!1,this.drawComplete()));return!0},CLASS_NAME:"OpenLayers.Handler.ArcEx"});OpenLayers.Handler.BezierCurve2Ex=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoBezierCurve2);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,0<a&&3>a?this.isDrawing=!0:3==a&&this.drawComplete());return!0},CLASS_NAME:"OpenLayers.Handler.BezierCurve2Ex"});OpenLayers.Handler.BezierCurve3Ex=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoBezierCurve3);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,0<a&&4>a?this.isDrawing=!0:4==a&&this.drawComplete());return!0},CLASS_NAME:"OpenLayers.Handler.BezierCurve3Ex"});OpenLayers.Handler.BezierCurveNEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoBezierCurveN);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),0<this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.BezierCurveNEx"});OpenLayers.Handler.CardinalCurveEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCardinalCurve);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),1<=this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.CardinalCurveEx"});OpenLayers.Handler.FreelineEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoFreeline);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),1<=this.controlPoints.length&&(this.isDrawing=!0));return!0},touchstart:function(a){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.map.isIESingleTouch=!1;this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.addControlPoint(a.xy);1<=this.controlPoints.length&&(this.isDrawing=!0);return!0},touchmove:function(a){this.lastTouchPx=a.xy;this.modifyFeature(a.xy);return!0},modifyFeature:function(a){if(this.lastUp&&this.lastUp.equals(a))return!0;this.point&&this.plotting||this.createFeature(a);var b=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;1==this.isDrawing&&(this.addControlPoint(a),this.plotting.geometry._controlPoints=this.cloneControlPoints(this.controlPoints),this.plotting.geometry.calculateParts());this.callback("modify",[this.point.geometry,this.getSketch(),!1]);this.point.geometry.clearBounds();this.drawFeature()},dblclick:function(a){this.drawComplete();return!1},touchend:function(a){this.drawComplete();this.map.isIESingleTouch=!0;return!1},CLASS_NAME:"OpenLayers.Handler.FreelineEx"});OpenLayers.Handler.PolyLineEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoPolyline);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),1<=this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.PolyLineEx"});OpenLayers.Handler.MultiPointEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoMultiPoint);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy));return!0},dblclick:function(a){this.drawComplete();return this.isDrawing=!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.MultiPointEx"});OpenLayers.Handler.PointEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoPoint);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),1==this.controlPoints.length&&this.drawComplete());return!0},CLASS_NAME:"OpenLayers.Handler.PointEx"});OpenLayers.Handler.CircleEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCircle);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;a&&2<a.features.length&&this.layer.features[0].destroy()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a?this.isDrawing=!0:2==a&&this.drawComplete());return!0},CLASS_NAME:"OpenLayers.Handler.CircleEx"});OpenLayers.Handler.CloseCurve=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoCloseCurve);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},destroyPersistedFeature:function(){var a=this.layer;a&&1<a.features.length&&this.layer.features[0].destroy()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),1<=this.controlPoints.length&&(this.isDrawing=!0));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.CloseCurve"});OpenLayers.Handler.EllipseEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoEllipse);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a?this.isDrawing=!0:2==a&&this.drawComplete());return!0},touchstart:function(a){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.map.isIESingleTouch=!1;this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.addControlPoint(a.xy);1<=this.controlPoints.length&&(this.isDrawing=!0);return!0},touchend:function(a){this.drawComplete();this.map.isIESingleTouch=!0;return!1},touchmove:function(a){this.lastTouchPx=a.xy;this.modifyFeature(a.xy);return!0},CLASS_NAME:"OpenLayers.Handler.EllipseEx"});OpenLayers.Handler.FreePolygon=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoFreePolygon);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),0<this.controlPoints.length&&(this.isDrawing=!0));return!0},modifyFeature:function(a){if(this.lastUp&&this.lastUp.equals(a))return!0;this.point&&this.plotting||this.createFeature(a);var b=this.layer.getLonLatFromViewPortPx(a);this.point.geometry.x=b.lon;this.point.geometry.y=b.lat;1==this.isDrawing&&(this.addControlPoint(a),this.plotting.geometry._controlPoints=this.cloneControlPoints(this.controlPoints),this.plotting.geometry.calculateParts());this.callback("modify",[this.point.geometry,this.getSketch(),!1]);this.point.geometry.clearBounds();this.drawFeature()},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.map.isIESingleTouch=!1;this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.addControlPoint(a.xy);1<=this.controlPoints.length&&(this.isDrawing=!0);return!0},touchend:function(a){this.drawComplete();this.map.isIESingleTouch=!0;return!1},touchmove:function(a){this.lastTouchPx=a.xy;this.modifyFeature(a.xy);return!0},CLASS_NAME:"OpenLayers.Handler.FreePolygon"});OpenLayers.Handler.GatheringPlace=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoGatheringPlace);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a?this.isDrawing=!0:2==a&&this.drawComplete());return!0},CLASS_NAME:"OpenLayers.Handler.GatheringPlace"});OpenLayers.Handler.Lune=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoLune);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a||2==a?this.isDrawing=!0:3==a&&(this.isDrawing=!1,this.drawComplete()));return!0},CLASS_NAME:"OpenLayers.Handler.Lune"});OpenLayers.Handler.PolygonEx=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoPolygonEx);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),0<this.controlPoints.length?this.isDrawing=!0:(this.isDrawing=!1,this.controlPoints=[],this.plotting=null));return!0},dblclick:function(a){this.drawComplete();return!1},touchstart:function(a){if(this.lastTouchPx&&this.passesTolerance(this.lastTouchPx,a.xy,this.pixelTolerance))return a.preventDefault(),this.drawComplete(),this.isDrawing=!1;this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.lastTouchPx=a.xy;return this.down(a)},down:function(a){this.mouseDown=!0;this.lastDown=a.xy;this.isDrawing=!0;this.touch||this.modifyFeature(a.xy);this.stoppedDown=this.stopDown;return!this.stopDown},touchend:function(a){if(this.isDrawing)return a.xy=this.lastTouchPx,this.up(a)},CLASS_NAME:"OpenLayers.Handler.PolygonEx"});OpenLayers.Handler.Rectangle=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoRectangle);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a?this.isDrawing=!0:2==a?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null));return!0},touchstart:function(a){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.map.isIESingleTouch=!1;this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.addControlPoint(a.xy);1<=this.controlPoints.length&&(this.isDrawing=!0);return!0},touchend:function(a){this.drawComplete();this.map.isIESingleTouch=!0;return!1},touchmove:function(a){this.lastTouchPx=a.xy;this.modifyFeature(a.xy);return!0},CLASS_NAME:"OpenLayers.Handler.Rectangle"});OpenLayers.Handler.RoundedRect=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoRoundedRect);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a?this.isDrawing=!0:2==a?this.drawComplete():(this.isDrawing=!1,this.controlPoints=[],this.plotting=null));return!0},touchstart:function(a){this.touch||(this.touch=!0,this.map.events.un({mousedown:this.mousedown,mouseup:this.mouseup,mousemove:this.mousemove,click:this.click,dblclick:this.dblclick,scope:this}));this.map.isIESingleTouch=!1;this.modifyFeature(a.xy);this.persist&&this.destroyPersistedFeature();this.addControlPoint(a.xy);1<=this.controlPoints.length&&(this.isDrawing=!0);return!0},touchend:function(a){this.drawComplete();this.map.isIESingleTouch=!0;return!1},touchmove:function(a){this.lastTouchPx=a.xy;this.modifyFeature(a.xy);return!0},CLASS_NAME:"OpenLayers.Handler.RoundedRect"});OpenLayers.Handler.Sector=OpenLayers.Class(OpenLayers.Handler.Plotting,{initialize:function(a,b,c){OpenLayers.Handler.Plotting.prototype.initialize.apply(this,arguments)},createFeature:function(a){a=this.layer.getLonLatFromViewPortPx(a);a=new OpenLayers.Geometry.Point(a.lon,a.lat);this.point=new OpenLayers.Feature.Vector(a);this.plotting=new OpenLayers.Feature.Vector(new OpenLayers.Geometry.GeoSector);this.callback("create",[this.point.geometry,this.getSketch()]);this.point.geometry.clearBounds()},up:function(a){this.mouseDown=!1;this.stoppedDown=this.stopDown;if(this.lastUp&&this.lastUp.equals(a.xy))return!0;this.lastDown&&this.passesTolerance(this.lastDown,a.xy,this.pixelTolerance)&&(this.touch&&this.modifyFeature(a.xy),this.persist&&this.destroyPersistedFeature(),this.lastUp=a.xy,this.addControlPoint(a.xy),a=this.controlPoints.length,1==a||2==a?this.isDrawing=!0:3==a&&(this.isDrawing=!1,this.drawComplete()));return!0},CLASS_NAME:"OpenLayers.Handler.Sector"});